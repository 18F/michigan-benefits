#!/usr/bin/env ruby
require_relative "bin_helpers"

chdir APP_ROOT do
  # This script is a way to update your development environment automatically.
  # Add necessary update steps to this file.

  step "Pulling from git" do
    system! "git pull --rebase"
  end

  step "Installing dependencies" do
    system! 'gem install bundler --conservative'
    system('bundle check') || system!('bundle install')
  end

  step "Updating database" do
    system! 'bin/rails db:migrate'
  end

  step "Removing old logs and tempfiles" do
    system! 'bin/rails log:clear tmp:clear'
  end

  step "Restarting application server" do
    system! 'bin/rails restart'
  end
end
